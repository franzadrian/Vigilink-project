{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}
  {% if page_type == 'events' %}Events - Not Available
  {% elif page_type == 'alerts' %}Alerts - Not Available
  {% else %}Residents - Not Available
  {% endif %}
{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
  .nm-wrap{max-width:clamp(320px,92vw,720px);width:100%;margin:24px auto;padding:24px;background:#fff;border:1px solid #eef2f7;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,0.06)}
  .nm-head{display:flex;align-items:center;gap:12px;margin-bottom:8px}
  .nm-head .icon{width:36px;height:36px;border-radius:10px;display:inline-flex;align-items:center;justify-content:center;background:#fee2e2;color:#b91c1c}
  .nm-title{font-size:1.25rem;font-weight:700;color:#111827;margin:0}
  .nm-text{color:#4b5563;line-height:1.6;margin-top:6px}
  .nm-actions{margin-top:16px;display:flex;gap:10px;flex-wrap:wrap}
  .nm-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;color:#374151;text-decoration:none}
  .nm-btn.primary{border-color:#2563eb;color:#2563eb}
  .nm-btn:hover{background:#f3f4f6}
  .nm-form{margin-top:16px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;width:100%}
  .nm-input{flex:1 1 auto;min-width:240px;width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px}
  .nm-submit{padding:10px 16px;border-radius:10px;border:1px solid #2563eb;background:#2563eb;color:#fff;cursor:pointer}
  .nm-submit:hover{background:#1d4ed8;border-color:#1d4ed8}
  .nm-messages{margin-top:10px}
  .nm-message{padding:8px 10px;border-radius:8px;margin-bottom:6px}
  .nm-message.error{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}
  .nm-message.success{background:#dcfce7;color:#166534;border:1px solid #bbf7d0}

  /* Guest info section styles */
  .nm-guest-info {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #e5e7eb;
  }

  .nm-emergency-card, .nm-safety-card {
    background: #f8fafc;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    overflow: hidden;
  }

  .nm-card-header {
    background: #f1f5f9;
    padding: 12px 16px;
    border-bottom: 1px solid #e5e7eb;
  }

  .nm-card-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    color: #374151;
    font-size: 14px;
  }

  .nm-card-title i {
    color: #dc2626;
    font-size: 14px;
  }

  .nm-safety-card .nm-card-title i {
    color: #2563eb;
  }

  .nm-card-body {
    padding: 16px;
  }

  .nm-contacts-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: 8px;
  }

  .nm-contact-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 6px 0;
    border-bottom: 1px dashed #d1d5db;
  }

  .nm-contact-item:last-child {
    border-bottom: none;
  }

  .nm-contact-label {
    color: #374151;
    font-weight: 500;
    font-size: 13px;
  }

  .nm-contact-number {
    color: #2563eb;
    text-decoration: none;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 13px;
  }

  .nm-contact-number:hover {
    text-decoration: underline;
  }

  .nm-safety-tip {
    color: #374151;
    font-size: 14px;
    line-height: 1.5;
    margin: 0 0 8px;
  }

  .nm-safety-note {
    color: #6b7280;
    font-size: 12px;
    margin: 0;
    font-style: italic;
  }

  @media (max-width: 640px){
    .nm-wrap{padding:16px}
    .nm-form{flex-direction:column;align-items:stretch}
    .nm-input{min-width:0}
    .nm-submit{width:100%}
    .nm-actions{justify-content:center}
    .nm-guest-info {
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 20px;
    }
  }
</style>
{% endblock %}

{% block content %}
  <div class="nm-wrap">
    <div class="nm-head">
      <div class="icon"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12" y2="16"></line></svg></div>
      <h2 class="nm-title">
        {% if page_type == 'events' %}Events Access Unavailable
        {% elif page_type == 'alerts' %}Alerts Access Unavailable
        {% else %}Residents Access Unavailable
        {% endif %}
      </h2>
    </div>
    <p class="nm-text">
      You are not part of any community yet. Enter the community code shared by your Community Owner to join.
    </p>
    {% if messages %}
    <div class="nm-messages">
      {% for message in messages %}
        <div class="nm-message {% if 'error' in message.tags %}error{% elif 'success' in message.tags %}success{% endif %}">{{ message }}</div>
      {% endfor %}
    </div>
    {% endif %}
    <form class="nm-form" method="post" action="{% url 'resident_panel:join_by_code' %}">
      {% csrf_token %}
      <input class="nm-input" type="text" name="community_code" placeholder="Enter community code (e.g., ABCD-EFGH-IJKL-MNOP)" required autocomplete="off">
      <button class="nm-submit" type="submit">Join Community</button>
    </form>
    <div class="nm-actions">
      <a class="nm-btn" href="{% url 'user_panel:contact' %}">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 8v8a2 2 0 01-2 2H5a2 2 0 01-2-2V8"/></svg>
        Contact Support
      </a>
    </div>
    
    <!-- Emergency Calls and Safety Tips for guest users -->
    <div class="nm-guest-info">
      <div class="nm-emergency-card">
        <header class="nm-card-header">
          <div class="nm-card-title">
            <i class="fa-solid fa-phone" aria-hidden="true"></i>
            <span>Emergency Calls</span>
          </div>
        </header>
        <div class="nm-card-body">
          {% if location_contacts %}
          <ul class="nm-contacts-list">
            {% for contact in location_contacts %}
            <li class="nm-contact-item">
              <span class="nm-contact-label">{{ contact.label }}</span>
              <a class="nm-contact-number" href="tel:{{ contact.phone }}"><i class="fa-solid fa-phone"></i> {{ contact.phone }}</a>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <ul class="nm-contacts-list">
            <li class="nm-contact-item">
              <span class="nm-contact-label">Police Emergency</span>
              <a class="nm-contact-number" href="tel:166"><i class="fa-solid fa-phone"></i> 166</a>
            </li>
            <li class="nm-contact-item">
              <span class="nm-contact-label">Fire Department</span>
              <a class="nm-contact-number" href="tel:160"><i class="fa-solid fa-phone"></i> 160</a>
            </li>
            <li class="nm-contact-item">
              <span class="nm-contact-label">Hospital Emergency</span>
              <a class="nm-contact-number" href="tel:161"><i class="fa-solid fa-phone"></i> 161</a>
            </li>
            <li class="nm-contact-item">
              <span class="nm-contact-label">Emergency Hotline</span>
              <a class="nm-contact-number" href="tel:911"><i class="fa-solid fa-phone"></i> 911</a>
            </li>
          </ul>
          {% endif %}
        </div>
      </div>
      
      <div class="nm-safety-card">
        <header class="nm-card-header">
          <div class="nm-card-title">
            <i class="fa-solid fa-shield-halved" aria-hidden="true"></i>
            <span>Safety Tip</span>
          </div>
        </header>
        <div class="nm-card-body">
          <p class="nm-safety-tip">Always verify the identity of service personnel before allowing them into your home. Ask for official identification and call their company to confirm their visit.</p>
          <p class="nm-safety-note">Join a community to get personalized safety tips and emergency contacts for your area.</p>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
