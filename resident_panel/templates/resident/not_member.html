{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}
  {% if page_type == 'events' %}Events - Not Available
  {% elif page_type == 'alerts' %}Alerts - Not Available
  {% elif page_type == 'dashboard' %}Dashboard - Not Available
  {% else %}Residents - Not Available
  {% endif %}
{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
  .nm-wrap{max-width:clamp(320px,92vw,720px);width:100%;margin:24px auto;padding:24px;background:#fff;border:1px solid #eef2f7;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,0.06)}
  .nm-head{display:flex;align-items:center;gap:12px;margin-bottom:8px}
  .nm-head .icon{width:36px;height:36px;border-radius:10px;display:inline-flex;align-items:center;justify-content:center;background:#fee2e2;color:#b91c1c}
  .nm-title{font-size:1.25rem;font-weight:700;color:#111827;margin:0}
  .nm-text{color:#4b5563;line-height:1.6;margin-top:6px}
  .nm-actions{margin-top:16px;display:flex;gap:10px;flex-wrap:wrap}
  .nm-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;color:#374151;text-decoration:none}
  .nm-btn.primary{border-color:#2563eb;color:#2563eb}
  .nm-btn:hover{background:#f3f4f6}
  .nm-form{margin-top:16px;display:flex;flex-direction:column;gap:12px;width:100%}
  .nm-input{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;box-sizing:border-box}
  .nm-submit{width:100%;padding:10px 16px;border-radius:10px;border:1px solid #2563eb;background:#2563eb;color:#fff;cursor:pointer;font-weight:600;text-align:center}
  .nm-submit:hover{background:#1d4ed8;border-color:#1d4ed8}
  .nm-messages{margin-top:10px}
  .nm-message{padding:8px 10px;border-radius:8px;margin-bottom:6px}
  .nm-message.error{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}
  .nm-message.success{background:#dcfce7;color:#166534;border:1px solid #bbf7d0}

  /* Guest info section styles */
  .nm-guest-info {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #e5e7eb;
  }

  .nm-emergency-card, .nm-safety-card {
    background: #f8fafc;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    overflow: hidden;
  }

  .nm-card-header {
    background: #f1f5f9;
    padding: 12px 16px;
    border-bottom: 1px solid #e5e7eb;
  }

  .nm-card-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    color: #374151;
    font-size: 14px;
  }

  .nm-card-title i {
    color: #dc2626;
    font-size: 14px;
  }

  .nm-safety-card .nm-card-title i {
    color: #2563eb;
  }

  .nm-card-body {
    padding: 16px;
  }

  .nm-contacts-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: 8px;
  }

  .nm-contact-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 6px 0;
    border-bottom: 1px dashed #d1d5db;
  }

  .nm-contact-item:last-child {
    border-bottom: none;
  }

  .nm-contact-label {
    color: #374151;
    font-weight: 500;
    font-size: 13px;
  }

  .nm-contact-number {
    color: #2563eb;
    text-decoration: none;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 13px;
  }

  .nm-contact-number:hover {
    text-decoration: underline;
  }

  .nm-safety-tip {
    color: #374151;
    font-size: 14px;
    line-height: 1.5;
    margin: 0 0 8px;
  }

  .nm-safety-note {
    color: #6b7280;
    font-size: 12px;
    margin: 0;
    font-style: italic;
  }

  /* Free Trial Section for Community Presidents */
  .nm-trial-section {
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
    border: 2px solid #3b82f6;
    border-radius: 12px;
    padding: 24px;
    margin-top: 0;
    margin-bottom: 0;
  }

  .nm-trial-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }

  .nm-trial-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: #3b82f6;
    color: white;
    font-size: 20px;
  }

  .nm-trial-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e40af;
    margin: 0;
  }

  .nm-trial-text {
    color: #1e3a8a;
    line-height: 1.6;
    margin-bottom: 16px;
    font-size: 14px;
  }

  .nm-trial-features {
    list-style: none;
    padding: 0;
    margin: 0 0 20px 0;
  }

  .nm-trial-features li {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #1e3a8a;
    margin-bottom: 8px;
    font-size: 14px;
  }

  .nm-trial-features li::before {
    content: "✓";
    color: #10b981;
    font-weight: bold;
    font-size: 16px;
  }

  .nm-trial-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    border-radius: 10px;
    border: none;
    background: #3b82f6;
    color: white;
    text-decoration: none;
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
  }

  .nm-trial-btn:hover {
    background: #2563eb;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
    color: white;
    text-decoration: none;
  }

  .nm-trial-note {
    color: #64748b;
    font-size: 12px;
    margin-top: 12px;
    font-style: italic;
  }

  /* Side by side layout for trial and code form */
  .nm-main-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 32px;
    margin-top: 32px;
  }

  .nm-code-section {
    display: flex;
    flex-direction: column;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 24px;
  }

  .nm-code-section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #111827;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .nm-code-section-title i {
    color: #3b82f6;
    font-size: 20px;
  }

  .nm-code-section-subtitle {
    color: #6b7280;
    font-size: 15px;
    font-weight: 500;
    margin-bottom: 16px;
  }

  .nm-code-section-text {
    color: #4b5563;
    font-size: 14px;
    line-height: 1.6;
    margin-bottom: 20px;
  }

  @media (max-width: 1024px){
    .nm-main-content {
      grid-template-columns: 1fr;
      gap: 24px;
    }
    .nm-code-section {
      padding: 20px;
    }
  }

  @media (max-width: 640px){
    .nm-wrap{padding:16px}
    .nm-form{flex-direction:column;align-items:stretch}
    .nm-input{min-width:0;width:100%}
    .nm-submit{width:100%}
    .nm-actions{justify-content:center}
    .nm-guest-info {
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 20px;
    }
    .nm-trial-section {
      padding: 16px;
    }
    .nm-trial-btn {
      width: 100%;
      justify-content: center;
    }
  }
</style>
{% endblock %}

{% block content %}
  <div class="nm-wrap">
    <div class="nm-head">
      <div class="icon"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12" y2="16"></line></svg></div>
      <h2 class="nm-title">
        {% if page_type == 'events' %}Events Access Unavailable
        {% elif page_type == 'alerts' %}Alerts Access Unavailable
        {% elif page_type == 'dashboard' %}Dashboard Access Unavailable
        {% elif page_type == 'resources' %}Resources Access Unavailable
        {% else %}Residents Access Unavailable
        {% endif %}
      </h2>
    </div>
    <p class="nm-text">
      You are not part of any community yet. Choose an option below to get started.
    </p>
    
    <div class="nm-main-content">
      <!-- Community Code Section -->
      <div class="nm-code-section">
        <h3 class="nm-code-section-title">
          <i class="fa-solid fa-users" aria-hidden="true"></i>
          Are you a Resident?
        </h3>
        <p class="nm-code-section-subtitle">
          Join an existing community
        </p>
        <p class="nm-code-section-text">
          Enter the community code shared by your Community President to join their community and access all features.
        </p>
        {% if messages %}
        <div class="nm-messages">
          {% for message in messages %}
            <div class="nm-message {% if 'error' in message.tags %}error{% elif 'success' in message.tags %}success{% endif %}">{{ message }}</div>
          {% endfor %}
        </div>
        {% endif %}
        <form class="nm-form" method="post" action="{% url 'resident_panel:join_by_code' %}">
          {% csrf_token %}
          {% if page_type %}<input type="hidden" name="next" value="{{ page_type }}">{% endif %}
          <input class="nm-input" type="text" name="community_code" placeholder="Enter community code" required autocomplete="off">
          <button class="nm-submit" type="submit">Join Community</button>
        </form>
      </div>

      <!-- Free Trial Section -->
      {% if is_guest or is_community_owner and not has_community_profile %}
        {% if not has_ever_had_trial or has_active_trial %}
      <div class="nm-trial-section">
        <div class="nm-trial-header">
          <div class="nm-trial-icon">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
              <path d="M2 17l10 5 10-5"></path>
              <path d="M2 12l10 5 10-5"></path>
            </svg>
          </div>
          <h3 class="nm-trial-title">Are you a Community President?</h3>
        </div>
        <p class="nm-trial-text" style="font-weight: 600; margin-bottom: 8px;">
          Start your free trial now!
        </p>
        <p class="nm-trial-text">
          Start a <strong>14-day free trial</strong> to explore all VigiLink features and create your own community. No credit card required!
        </p>
        <ul class="nm-trial-features">
          <li>Full access to all community management features</li>
          <li>Create and manage your community</li>
          <li>Invite residents and manage members</li>
          <li>Access all pages and features</li>
          <li>No payment required during trial</li>
        </ul>
        {% if not has_active_trial %}
        <form method="post" action="{% url 'settings_panel:start_free_trial' %}" style="margin: 0;">
          {% csrf_token %}
          <button type="submit" class="nm-trial-btn">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 13l4 4L19 7"></path>
            </svg>
            Start Free Trial Now
          </button>
        </form>
        <p class="nm-trial-note">After 14 days, you can choose to continue with a paid subscription. If you don't subscribe, your trial data will be deleted after 1 month.</p>
        {% else %}
        <div style="padding: 12px; background: #dcfce7; border-radius: 8px; margin-top: 12px;">
          <p style="margin: 0; color: #166534; font-weight: 600; font-size: 14px;">✓ Your free trial is active! You can now create your community.</p>
        </div>
        {% endif %}
      </div>
        {% endif %}
      {% else %}
      <!-- Show trial section for non-guests too, but with different messaging -->
      <div class="nm-trial-section" style="opacity: 0.7;">
        <div class="nm-trial-header">
          <div class="nm-trial-icon">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
              <path d="M2 17l10 5 10-5"></path>
              <path d="M2 12l10 5 10-5"></path>
            </svg>
          </div>
          <h3 class="nm-trial-title">Are you a Community President?</h3>
        </div>
        <p class="nm-trial-text" style="font-weight: 600; margin-bottom: 8px;">
          Create your own community
        </p>
        <p class="nm-trial-text">
          Want to create your own community? Contact support to learn about our community management plans.
        </p>
        <div class="nm-actions" style="margin-top: 16px;">
          <a class="nm-btn" href="{% url 'user_panel:contact' %}">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 8v8a2 2 0 01-2 2H5a2 2 0 01-2-2V8"/></svg>
            Contact Support
          </a>
        </div>
      </div>
      {% endif %}
    </div>
    
    {% if not is_guest and not is_community_owner %}
    <div class="nm-actions" style="margin-top: 24px;">
      <a class="nm-btn" href="{% url 'user_panel:contact' %}">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 8v8a2 2 0 01-2 2H5a2 2 0 01-2-2V8"/></svg>
        Contact Support
      </a>
    </div>
    {% endif %}
    
    <!-- Emergency Calls and Safety Tips for guest users -->
    <div class="nm-guest-info">
      <div class="nm-emergency-card">
        <header class="nm-card-header">
          <div class="nm-card-title">
            <i class="fa-solid fa-phone" aria-hidden="true"></i>
            <span>Emergency Calls</span>
          </div>
        </header>
        <div class="nm-card-body">
          {% if location_contacts %}
          <ul class="nm-contacts-list">
            {% for contact in location_contacts %}
            <li class="nm-contact-item">
              <span class="nm-contact-label">{{ contact.label }}</span>
              <a class="nm-contact-number" href="tel:{{ contact.phone }}"><i class="fa-solid fa-phone"></i> {{ contact.phone }}</a>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <ul class="nm-contacts-list">
            <li class="nm-contact-item">
              <span class="nm-contact-label">Police Emergency</span>
              <a class="nm-contact-number" href="tel:166"><i class="fa-solid fa-phone"></i> 166</a>
            </li>
            <li class="nm-contact-item">
              <span class="nm-contact-label">Fire Department</span>
              <a class="nm-contact-number" href="tel:160"><i class="fa-solid fa-phone"></i> 160</a>
            </li>
            <li class="nm-contact-item">
              <span class="nm-contact-label">Hospital Emergency</span>
              <a class="nm-contact-number" href="tel:161"><i class="fa-solid fa-phone"></i> 161</a>
            </li>
            <li class="nm-contact-item">
              <span class="nm-contact-label">Emergency Hotline</span>
              <a class="nm-contact-number" href="tel:911"><i class="fa-solid fa-phone"></i> 911</a>
            </li>
          </ul>
          {% endif %}
        </div>
      </div>
      
      <div class="nm-safety-card">
        <header class="nm-card-header">
          <div class="nm-card-title">
            <i class="fa-solid fa-shield-halved" aria-hidden="true"></i>
            <span>Safety Tip</span>
          </div>
        </header>
        <div class="nm-card-body">
          <p class="nm-safety-tip">Always verify the identity of service personnel before allowing them into your home. Ask for official identification and call their company to confirm their visit.</p>
          <p class="nm-safety-note">Join a community to get personalized safety tips and emergency contacts for your area.</p>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
