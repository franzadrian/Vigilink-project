{% load time_filters %}
<div id="communication-container">
<div class="table-wrapper" style="overflow-x:auto;">
  <table id="comm-table" class="comm-table" style="width:100%; border-collapse:separate; border-spacing:0; font-size:14px;">
    <thead>
      <tr style="background:#f8fafc;">
        <th style="text-align:left; padding:10px 12px; border-bottom:1px solid #e5e7eb;">Full Name</th>
        <th style="text-align:left; padding:10px 12px; border-bottom:1px solid #e5e7eb;">Type</th>
        <th style="text-align:left; padding:10px 12px; border-bottom:1px solid #e5e7eb;">Status</th>
        <th style="text-align:right; padding:10px 12px; border-bottom:1px solid #e5e7eb;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for message in contact_messages %}
      {% with subj=message.subject|lower %}
        <tr class="comm-row {% if not message.is_read %}unread{% endif %}" data-user-id="{{ message.user.id|default:'' }}" data-message-id="{{ message.contact_id }}" data-name="{{ message.name|escape }}"
            data-type="{% if 'feedback' in subj %}Feedback{% elif 'report' in subj %}Report{% elif 'inquiry' in subj or 'enquiry' in subj %}General Inquiry{% else %}General Inquiry{% endif %}"
            data-is-read="{% if message.is_read %}1{% else %}0{% endif %}" data-created-at="{{ message.created_at|date:'c' }}">
          <td style="padding:10px 12px;" data-label="Full Name">{{ message.name }}</td>
          <td style="padding:10px 12px;" data-label="Type">
            <span class="badge" style="display:inline-block; padding:4px 8px; border-radius:999px; background:#eef2ff; color:#1e3a8a; font-weight:600; font-size:12px;">
              {% if 'feedback' in subj %}Feedback{% elif 'report' in subj %}Report{% elif 'inquiry' in subj or 'enquiry' in subj %}General Inquiry{% else %}General Inquiry{% endif %}
            </span>
          </td>
          <td class="status-cell" style="padding:10px 12px;" data-label="Status">
            {% if message.is_read %}
              <span class="status done" style="color:#065f46; background:#d1fae5; padding:3px 8px; border-radius:6px; font-weight:600; font-size:12px;">Done</span>
            {% else %}
              <span class="status active" style="color:#1e3a8a; background:#e0e7ff; padding:3px 8px; border-radius:6px; font-weight:600; font-size:12px;">Active</span>
            {% endif %}
          </td>
          <td class="actions-cell" style="padding:10px 12px; text-align:right; display:flex; align-items:center; gap:10px; justify-content:flex-end;" data-label="Actions">
            <div class="actions-group" style="display:flex; gap:10px;">
              <button class="btn view-btn action-btn" aria-label="View conversation" style="padding:6px 10px; border:1px solid #d1d5db; border-radius:6px; background:#fff; cursor:pointer;"><i class="fas fa-eye" aria-hidden="true"></i><span class="btn-text">View</span></button>
              {% if not message.is_read %}
              <button class="btn mark-btn action-btn" aria-label="Mark as done" style="padding:6px 10px; border:1px solid #10b981; border-radius:6px; background:#d1fae5; color:#065f46; cursor:pointer; "><i class="fas fa-check" aria-hidden="true"></i><span class="btn-text">Mark as Done</span></button>
              {% endif %}
            </div>
          </td>
        </tr>
      {% endwith %}
      {% empty %}
        <tr>
          <td colspan="4" style="padding:20px; text-align:center; color:#6b7280;">No messages found.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
{% if page_obj.has_other_pages %}
<div class="pagination" id="pagination-container">
  {% if page_obj.has_previous %}
    <button type="button" class="page-link" data-page="{{ page_obj.previous_page_number }}">Previous</button>
  {% endif %}
  
  <span class="current">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
  
  {% if page_obj.has_next %}
    <button type="button" class="page-link" data-page="{{ page_obj.next_page_number }}">Next</button>
  {% endif %}
</div>
{% endif %}
</div>
