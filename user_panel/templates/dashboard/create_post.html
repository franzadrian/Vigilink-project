{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Create Post - VigiLink{% endblock %}

{% block content %}
<div class="create-post-container">
    <div class="create-post-header">
        <h2>Create a New Post</h2>
    </div>
    <form method="post" enctype="multipart/form-data" class="create-post-form">
        {% csrf_token %}
        <div class="form-group">
            <label for="message">Message</label>
            <textarea id="message" name="message" rows="4" placeholder="What's on your mind?" required></textarea>
        </div>

        <div class="form-group">
            <label for="images">Attach Images (up to 20)</label>
            <input type="file" id="images" name="images" accept="image/*" multiple class="hidden-file-input" max="20">
            <label for="images" class="file-input-label">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                Choose Images
            </label>
            <span class="file-name" id="images-count-display">No images chosen</span>
            <div id="image-preview-container" class="image-preview-container"></div>
        </div>
        <script>

            document.getElementById('images').addEventListener('change', function(e) {
                var fileCount = e.target.files.length;
                var countDisplay = document.getElementById('images-count-display');
                var previewContainer = document.getElementById('image-preview-container');
                
                // Clear previous previews
                previewContainer.innerHTML = '';
                
                if (fileCount > 0) {
                    countDisplay.textContent = fileCount + (fileCount === 1 ? ' image' : ' images') + ' selected';
                    
                    // Create image previews (up to 4)
                    var previewCount = Math.min(fileCount, 4);
                    for (var i = 0; i < previewCount; i++) {
                        var file = e.target.files[i];
                        if (file.type.match('image.*')) {
                            var preview = document.createElement('div');
                            preview.className = 'image-preview';
                            
                            // If this is the 4th preview and there are more images
                            if (i === 3 && fileCount > 4) {
                                preview.className += ' stacked-preview';
                                var overlay = document.createElement('div');
                                overlay.className = 'stacked-overlay';
                                overlay.textContent = '+' + (fileCount - 3);
                                preview.appendChild(overlay);
                            }
                            
                            var img = document.createElement('img');
                            var reader = new FileReader();
                            
                            reader.onload = (function(aImg) { 
                                return function(e) { 
                                    aImg.src = e.target.result; 
                                }; 
                            })(img);
                            
                            reader.readAsDataURL(file);
                            preview.appendChild(img);
                            previewContainer.appendChild(preview);
                        }
                    }
                } else {
                    countDisplay.textContent = 'No images chosen';
                }
            });
        </script>
        <div class="form-actions">
            <a href="{% url 'user_panel:dashboard' %}" class="cancel-btn">Cancel</a>
            <button type="submit" class="submit-btn">Post</button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
{% endblock %}